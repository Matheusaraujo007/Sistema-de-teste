<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minha Loja Online</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
  body { background:#f4f7f9; min-height:100vh; display:flex; flex-direction:column; }

  header {
    background: linear-gradient(90deg,#0077b6,#00b4d8);
    color:white;
    padding:20px 40px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    flex-wrap:wrap;
    box-shadow:0 2px 6px rgba(0,0,0,0.2);
    position:sticky; top:0; z-index:100;
  }
  header h1 { font-size:1.6em; letter-spacing:1px; }
  
  .search-bar { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  .search-bar input {
    padding:10px 15px; border-radius:10px; border:none; outline:none; font-size:1em;
  }
  .cart-icon {
    cursor:pointer; font-size:1.6em; position:relative;
  }
  .cart-count {
    position:absolute; top:-8px; right:-10px;
    background:red; color:white; font-size:0.8em; padding:2px 6px; border-radius:50%;
  }

  .categorias {
    display:flex; justify-content:center; gap:15px; margin:20px 0; flex-wrap:wrap;
  }
  .categoria-btn {
    padding:10px 20px; border:none; border-radius:20px;
    background:#00b4d8; color:white; cursor:pointer; transition:0.3s; font-weight:600;
  }
  .categoria-btn.active, .categoria-btn:hover { background:#0077b6; }

  main {
    flex:1; padding:20px; display:grid;
    grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:25px;
  }

  .produto {
    background:white; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1);
    overflow:hidden; transition:0.3s; display:flex; flex-direction:column; justify-content:space-between;
  }
  .produto:hover { transform:translateY(-6px); box-shadow:0 8px 20px rgba(0,0,0,0.15); }
  .produto img { width:100%; height:230px; object-fit:cover; }
  .produto .info { padding:15px; flex:1; display:flex; flex-direction:column; justify-content:space-between; }
  .produto h3 { color:#023e8a; margin-bottom:6px; font-size:1.2em; }
  .produto p { color:#555; font-size:0.95em; margin-bottom:10px; flex:1; }
  .preco { color:#0077b6; font-weight:bold; margin-bottom:10px; font-size:1.1em; }
  .btn-comprar { background:#00b4d8; color:white; padding:12px; border:none; border-radius:10px; cursor:pointer; font-weight:600; transition:0.3s; }
  .btn-comprar:hover { background:#0077b6; transform:scale(1.05); }

  .carrinho {
    position:fixed; right:-400px; top:0; width:400px; height:100%;
    background:white; box-shadow:-2px 0 15px rgba(0,0,0,0.2);
    padding:20px; transition:0.4s; z-index:200; overflow-y:auto;
  }
  .carrinho.open { right:0; }
  .carrinho h2 { color:#023e8a; margin-bottom:15px; }
  .item-carrinho {
    display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;
  }
  .item-info { flex:1; display:flex; justify-content:space-between; align-items:center; }
  .btn-remover { background:#e63946; color:white; border:none; border-radius:6px; padding:4px 8px; cursor:pointer; }
  .btn-qty { background:#0077b6; color:white; border:none; border-radius:6px; padding:2px 8px; cursor:pointer; margin:0 2px; }

  .btn-finalizar {
    background:#0077b6; color:white; border:none; width:100%; padding:12px; border-radius:8px;
    font-weight:600; cursor:pointer; transition:0.3s;
  }
  .btn-finalizar:hover { background:#023e8a; }

  .modal {
    position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6);
    display:flex; align-items:center; justify-content:center; z-index:300;
    visibility:hidden; opacity:0; transition:0.3s;
  }
  .modal.show { visibility:visible; opacity:1; }
  .formulario {
    background:white; padding:25px; border-radius:14px; width:90%; max-width:500px;
    box-shadow:0 6px 20px rgba(0,0,0,0.3); animation:fadeIn 0.4s;
  }
  @keyframes fadeIn { from{transform:scale(0.9); opacity:0} to{transform:scale(1); opacity:1} }

  .formulario h3 { margin-bottom:10px; color:#023e8a; text-align:center; }
  .formulario label { display:block; margin-top:10px; font-weight:600; }
  .formulario input, .formulario textarea {
    width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; margin-top:4px;
  }
  .formulario button {
    margin-top:15px; background:#25D366; color:white; padding:12px; border:none; border-radius:8px;
    width:100%; font-weight:600; cursor:pointer;
  }

  .whatsapp-float {
    position:fixed; bottom:25px; right:25px; background:#25D366; border-radius:50%;
    width:70px; height:70px; display:flex; justify-content:center; align-items:center;
    box-shadow:0 4px 15px rgba(0,0,0,0.3); text-decoration:none; transition:0.3s; z-index:400;
  }
  .whatsapp-float:hover { transform:scale(1.1); background:#1ebe5d; }
  .whatsapp-float svg { width:38px; height:38px; fill:white; }

  footer { background:#0077b6; color:white; text-align:center; padding:15px; }

  @media(max-width:600px){
    .carrinho{width:100%;}
    .formulario{width:95%;}
    .categorias{flex-direction:column;}
  }
</style>
</head>
<body>

<header>
  <h1>üõçÔ∏è Minha Loja Online</h1>
  <div class="search-bar">
    <input type="text" placeholder="Buscar produtos..." id="searchInput" oninput="filtrarProdutos()">
    <div class="cart-icon" onclick="toggleCarrinho()">
      üõí<span class="cart-count" id="cartCount">0</span>
    </div>
  </div>
</header>

<div class="categorias" id="categorias"></div>

<main id="produtosContainer"></main>

<div class="carrinho" id="carrinho">
  <h2>üõí Meu Carrinho</h2>
  <div id="itensCarrinho"></div>
  <p><b>Total: R$ <span id="total">0.00</span></b></p>
  <button class="btn-finalizar" onclick="abrirFormulario()">Finalizar Pedido</button>
</div>

<div class="modal" id="modalForm">
  <div class="formulario">
    <h3>Finalize seu Pedido</h3>
    <label>1Ô∏è‚É£ Seu Nome:</label><input id="nomeCliente" type="text">
    <label>2Ô∏è‚É£ Retirada ou Entrega:</label><input id="retiradaEntrega" type="text">
    <label>3Ô∏è‚É£ Observa√ß√µes adicionais:</label><textarea id="maisInfo" rows="3"></textarea>
    <button onclick="enviarWhatsApp()">Enviar pelo WhatsApp</button>
  </div>
</div>

<a href="https://wa.me/5588993800944" target="_blank" class="whatsapp-float" title="Fale conosco">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M16 3C9.373 3 4 8.373 4 15c0 2.651.87 5.12 2.333 7.121L5 29l6.081-1.276A11.945 11.945 0 0016 27c6.627 0 12-5.373 12-12S22.627 3 16 3z"/></svg>
</a>

<footer>¬© 2025 Minha Loja Online ‚Äî Todos os direitos reservados</footer>

<script>
let produtos = [];
let carrinho = [];

async function carregarProdutos() {
  try {
    const res = await fetch("https://sistema-de-teste-sepia.vercel.app/api/produtos");
    produtos = await res.json();
    renderCategorias();
    renderProdutos();
  } catch (err) {
    console.error("Erro ao carregar produtos:", err);
  }
}

function renderCategorias() {
  const categoriasSet = new Set(produtos.map(p => p.categoria));
  const catDiv = document.getElementById('categorias');
  catDiv.innerHTML = `<button class="categoria-btn active" onclick="filtrarCategoria('todas',this)">Todas</button>` +
    Array.from(categoriasSet).map(c => `<button class="categoria-btn" onclick="filtrarCategoria('${c}',this)">${c}</button>`).join('');
}

function renderProdutos(filtro='todas') {
  const container = document.getElementById('produtosContainer');
  container.innerHTML = '';
  produtos.filter(p => filtro==='todas' || p.categoria===filtro).forEach(p => {
    const div = document.createElement('div');
    div.className = 'produto';
    div.innerHTML = `
      <img src="${p.imagem || 'https://via.placeholder.com/300x230'}" alt="${p.nome}">
      <div class="info">
        <h3>${p.nome}</h3>
        <p>${p.descricao}</p>
        <p class="preco">R$ ${parseFloat(p.preco).toFixed(2)}</p>
        <button class="btn-comprar" onclick="addCarrinho('${p.nome}',${p.preco})">Comprar</button>
      </div>`;
    container.appendChild(div);
  });
}

function filtrarCategoria(categoria, btn) {
  document.querySelectorAll('.categoria-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderProdutos(categoria);
}

function filtrarProdutos() {
  const valor = document.getElementById('searchInput').value.toLowerCase();
  const container = document.getElementById('produtosContainer');
  container.innerHTML = '';
  produtos.filter(p=>p.nome.toLowerCase().includes(valor) || p.descricao.toLowerCase().includes(valor))
  .forEach(p=>{
    const div=document.createElement('div');
    div.className='produto';
    div.innerHTML=`<img src="${p.imagem}" alt="${p.nome}">
    <div class="info"><h3>${p.nome}</h3><p>${p.descricao}</p><p class="preco">R$ ${parseFloat(p.preco).toFixed(2)}</p>
    <button class="btn-comprar" onclick="addCarrinho('${p.nome}',${p.preco})">Comprar</button></div>`;
    container.appendChild(div);
  });
}

function addCarrinho(nome, preco) {
  const existente = carrinho.find(i => i.nome === nome);
  if (existente) existente.qtd++;
  else carrinho.push({nome, preco, qtd:1});
  renderCarrinho();
}

function renderCarrinho() {
  const itensDiv = document.getElementById('itensCarrinho');
  const totalEl = document.getElementById('total');
  const cartCount = document.getElementById('cartCount');
  itensDiv.innerHTML = '';
  let total = 0;
  carrinho.forEach((item,i)=>{
    total += item.preco * item.qtd;
    itensDiv.innerHTML += `
      <div class='item-carrinho'>
        <div class="item-info">
          <span>${item.nome} (R$${item.preco.toFixed(2)})</span>
          <div>
            <button class='btn-qty' onclick='alterarQtd(${i},-1)'>-</button>
            ${item.qtd}
            <button class='btn-qty' onclick='alterarQtd(${i},1)'>+</button>
            <button class='btn-remover' onclick='remover(${i})'>X</button>
          </div>
        </div>
      </div>`;
  });
  totalEl.textContent = total.toFixed(2);
  cartCount.textContent = carrinho.reduce((a,b)=>a+b.qtd,0);
}

function alterarQtd(i,delta){
  carrinho[i].qtd += delta;
  if(carrinho[i].qtd < 1) carrinho.splice(i,1);
  renderCarrinho();
}

function remover(i){ carrinho.splice(i,1); renderCarrinho(); }
function toggleCarrinho(){ document.getElementById('carrinho').classList.toggle('open'); }
function abrirFormulario(){ document.getElementById('modalForm').classList.add('show'); }

function enviarWhatsApp() {
  const nome = document.getElementById('nomeCliente').value;
  const entrega = document.getElementById('retiradaEntrega').value;
  const mais = document.getElementById('maisInfo').value;

  let texto = `üõçÔ∏è *Novo Pedido*%0A%0A`;
  carrinho.forEach(p=>texto += `‚Ä¢ ${p.nome} x${p.qtd} - R$ ${(p.preco*p.qtd).toFixed(2)}%0A`);
  texto += `%0Aüë§ Nome: ${nome}%0Aüì¶ Retirada/Entrega: ${entrega}%0Aüí¨ Observa√ß√µes: ${mais}`;
  window.open(`https://wa.me/5588993800944?text=${texto}`,"_blank");
}

carregarProdutos();
</script>
</body>
</html>
